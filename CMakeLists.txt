cmake_minimum_required(VERSION 3.20)
project(CppCourse LANGUAGES CXX)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ C++
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
enable_testing()  # ‚úÖ –î–û–ë–ê–í–¨–¢–ï –≠–¢–û! –ë–µ–∑ —ç—Ç–æ–≥–æ CTest –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å–±–æ—Ä–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
set(CMAKE_BINARY_DIR ${CMAKE_SOURCE_DIR}/build)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)

# –í–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥–ø—Ä–æ–µ–∫—Ç–æ–≤ (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö)
add_subdirectory(lab1)

# –î–æ–±–∞–≤—å—Ç–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö, –∫–æ–≥–¥–∞ –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è
# add_subdirectory(lab2)
# add_subdirectory(lab3)

# üîß –°–æ–∑–¥–∞–µ–º —É–¥–æ–±–Ω—ã–µ —Ü–µ–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
add_custom_target(run-all-tests
    COMMAND ${CMAKE_CTEST_COMMAND} --output-on-failure
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤"
    VERBATIM
)

# –¶–µ–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç
add_custom_target(test-lab1
    COMMAND ${CMAKE_CTEST_COMMAND} --tests-regex ".*" --output-on-failure
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/lab1
    COMMENT "–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ lab1"
    VERBATIM
)

file(WRITE "${CMAKE_BINARY_DIR}/DartConfiguration.tcl"
    "# Minimal Dart configuration for CTest\n"
    "Site: \n"
    "BuildName: \n"
)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ü–µ–ª–µ–π
# function(add_lab_test_target lab_name)
#     add_custom_target(test-${lab_name}
#         COMMAND ${CMAKE_CTEST_COMMAND} --output-on-failure
#         WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/${lab_name}
#         COMMENT "–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ ${lab_name}"
#         VERBATIM
#     )
# endfunction()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
# add_lab_test_target(lab1)
# add_lab_test_target(lab2)  # –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ lab2